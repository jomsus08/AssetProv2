<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Accounts | AssetPro</title>
<!-- Idagdag ito para gumana ang bcrypt sa browser -->
<script src="https://cdnjs.cloudflare.com"></script>

<!-- 1. Bcrypt JS (must be first) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js" crossorigin="anonymous"></script>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>



<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>

<body class="bg-slate-50 font-[Plus Jakarta Sans]">
<div class="flex h-screen overflow-hidden">

<!-- SIDEBAR -->
<div x-data="{ sidebarContent: '' }"
     x-init="
        fetch('sidebar.html')
            .then(response => {
                if (!response.ok) throw new Error('File not found');
                return response.text();
            })
            .then(html => { 
                sidebarContent = html; 
                $nextTick(() => {
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }
                });
            })
            .catch(err => console.error('Error loading sidebar:', err))
     "
     x-html="sidebarContent">
</div>


<!-- MAIN -->
<main class="flex-1 p-10" x-data="accountsApp" x-init="init()">


<div class="flex justify-between items-center mb-6">
  <h2 class="text-3xl font-extrabold">User Accounts</h2>
  <button x-show="isAdmin"
    @click="openModal()"
    class="bg-blue-600 text-white px-4 py-2 rounded-xl font-bold">
    Add User
  </button>
</div>

<input type="text" placeholder="Search users..."
  class="border rounded px-3 py-2 w-1/3 mb-4"
  x-model="searchQuery"
  @input.debounce.300ms="filterUsers()">

<!-- TABLE -->
<div class="bg-white rounded-2xl shadow border overflow-hidden">
<table class="w-full text-sm">
<thead class="bg-slate-50 uppercase text-xs font-bold">
<tr>
  <th class="px-6 py-4">Username</th>
  <th class="px-6 py-4">Email</th>
  <th class="px-6 py-4">Role</th>
  <th class="px-6 py-4">Created</th>
  <th class="px-6 py-4">Actions</th>
</tr>
</thead>
<tbody class="divide-y">
<template x-for="user in filteredUsers" :key="user.id">
<tr>
  <td class="px-6 py-3 font-semibold" x-text="user.username"></td>
  <td class="px-6 py-3" x-text="user.email"></td>
  <td class="px-6 py-3" x-text="user.role"></td>
  <td class="px-6 py-3" x-text="new Date(user.created_at).toLocaleDateString()"></td>
  <td class="px-6 py-3 flex gap-2">
    <button x-show="isAdmin"
      @click="editUser(user)"
      class="bg-indigo-500 text-white px-3 py-1 rounded-xl flex gap-1">
      <i data-lucide="edit-3" class="w-4 h-4"></i>Edit
    </button>
    <button x-show="isAdmin"
      @click="deleteUser(user.id)"
      class="bg-rose-500 text-white px-3 py-1 rounded-xl flex gap-1">
      <i data-lucide="trash-2" class="w-4 h-4"></i>Delete
    </button>
  </td>
</tr>
</template>
</tbody>
</table>
</div>

<!-- MODAL -->
<div x-show="showModal" style="display: none;" x-cloak class="fixed inset-0 bg-black/40 flex items-center justify-center z-50">
<div class="bg-white w-1/3 rounded-2xl p-6 shadow-lg">

<h2 class="text-xl font-bold mb-4" x-text="editMode ? 'Edit User' : 'Add User'"></h2>

<div class="space-y-4">

<input type="text" placeholder="Username"
  class="w-full border rounded px-3 py-2"
  x-model="currentUser.username">

<input type="email" placeholder="Email"
  class="w-full border rounded px-3 py-2"
  x-model="currentUser.email">

<select class="w-full border rounded px-3 py-2"
  x-model="currentUser.role">
  <option value="">Select Role</option>
  <option>User</option>
  <option>Manager</option>
  <option>HR</option>
  <option>Accounting</option>
  <option>Administrator</option>
</select>

<!-- PASSWORD (ADD MODE ONLY) -->
<template x-if="editMode">
<div class="space-y-3">

<input type="password" placeholder="Temporary Password"
  class="w-full border rounded px-3 py-2"
  x-model="password">

<input type="password" placeholder="Confirm Password"
  class="w-full border rounded px-3 py-2"
  x-model="confirmPassword">

<label class="flex items-center gap-2 text-sm">
  <input type="checkbox" x-model="mustChangePassword">
  User must change password before login
</label>

</div>
</template>

</div>

<div class="mt-6 flex justify-end gap-3">
<button @click="closeModal()" class="px-4 py-2 border rounded">Cancel</button>
<button @click="saveUser()" class="px-4 py-2 bg-blue-600 text-white rounded font-bold">
Save
</button>
</div>

</div>
</div>

</main>
</div>

<script src="accounts.js"></script>


<script>lucide.createIcons()</script>
</body>
</html>
